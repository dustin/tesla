<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module:      Tesla
Description: Tesla API implementation.

'Tesla' is intended to provide access to all known Tesla APIs as
documented at https://tesla-api.timdorr.com/
-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE RecordWildCards   #-}</span><span>
</span><a name="line-11"></a><span class="hs-pragma">{-# LANGUAGE TemplateHaskell   #-}</span><span>
</span><a name="line-12"></a><span class="hs-pragma">{-# LANGUAGE TupleSections     #-}</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Tesla</span><span>
</span><a name="line-15"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="Tesla.html#authenticate"><span class="hs-identifier hs-var">authenticate</span></a><span class="hs-special">,</span><span> </span><a href="Tesla.html#refreshAuth"><span class="hs-identifier hs-var">refreshAuth</span></a><span class="hs-special">,</span><span> </span><a href="Tesla.Auth.html#AuthResponse"><span class="hs-identifier hs-type">AuthResponse</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>      </span><a href="Tesla.html#Product"><span class="hs-identifier hs-type">Product</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Tesla.html#vehicleName"><span class="hs-identifier hs-var">vehicleName</span></a><span class="hs-special">,</span><span> </span><a href="Tesla.html#vehicleID"><span class="hs-identifier hs-var">vehicleID</span></a><span class="hs-special">,</span><span> </span><a href="Tesla.html#energyID"><span class="hs-identifier hs-var">energyID</span></a><span class="hs-special">,</span><span> </span><a href="Tesla.html#_ProductVehicle"><span class="hs-identifier hs-var">_ProductVehicle</span></a><span class="hs-special">,</span><span> </span><a href="Tesla.html#_ProductEnergy"><span class="hs-identifier hs-var">_ProductEnergy</span></a><span class="hs-special">,</span><span> </span><a href="Tesla.html#_ProductPowerWall"><span class="hs-identifier hs-var">_ProductPowerWall</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>      </span><a href="Tesla.html#VehicleID"><span class="hs-identifier hs-type">VehicleID</span></a><span class="hs-special">,</span><span> </span><a href="Tesla.html#vehicles"><span class="hs-identifier hs-var">vehicles</span></a><span class="hs-special">,</span><span> </span><a href="Tesla.html#products"><span class="hs-identifier hs-var">products</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>      </span><a href="Tesla.html#EnergyID"><span class="hs-identifier hs-type">EnergyID</span></a><span class="hs-special">,</span><span> </span><a href="Tesla.html#energyIDs"><span class="hs-identifier hs-var">energyIDs</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>      </span><a href="Tesla.Auth.html#fromToken"><span class="hs-identifier hs-var">fromToken</span></a><span class="hs-special">,</span><span> </span><a href="Tesla.Internal.HTTP.html#authOpts"><span class="hs-identifier hs-var">authOpts</span></a><span class="hs-special">,</span><span> </span><a href="Tesla.html#baseURL"><span class="hs-identifier hs-var">baseURL</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>      </span><a href="Tesla.html#decodeProducts"><span class="hs-identifier hs-var">decodeProducts</span></a><span>
</span><a name="line-21"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Lens</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.IO.Class</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadIO</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Aeson</span><span>             </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Value</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Aeson.Lens</span><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">key</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">_Array</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">_Integer</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">_String</span><span class="hs-special">)</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Foldable</span><span>          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">asum</span><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Map.Strict</span><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span class="hs-special">)</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map.Strict</span><span>        </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Maybe</span><span>             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">catMaybes</span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Text</span><span>              </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Text</span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Network.Wreq</span><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FormParam</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span>           </span><a href="Tesla.Auth.html"><span class="hs-identifier">Tesla.Auth</span></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span>           </span><a href="Tesla.Internal.HTTP.html"><span class="hs-identifier">Tesla.Internal.HTTP</span></a><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span class="hs-identifier">baseURL</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-39"></a><a name="baseURL"><a href="Tesla.html#baseURL"><span class="hs-identifier">baseURL</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;https://owner-api.teslamotors.com/&quot;</span><span>
</span><a name="line-40"></a><span class="hs-identifier">authURL</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-41"></a><a name="authURL"><a href="Tesla.html#authURL"><span class="hs-identifier">authURL</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Tesla.html#baseURL"><span class="hs-identifier hs-var">baseURL</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;oauth/token&quot;</span><span>
</span><a name="line-42"></a><span class="hs-identifier">authRefreshURL</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-43"></a><a name="authRefreshURL"><a href="Tesla.html#authRefreshURL"><span class="hs-identifier">authRefreshURL</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Tesla.html#baseURL"><span class="hs-identifier hs-var">baseURL</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;oauth/token&quot;</span><span>
</span><a name="line-44"></a><span class="hs-identifier">productsURL</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-45"></a><a name="productsURL"><a href="Tesla.html#productsURL"><span class="hs-identifier">productsURL</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Tesla.html#baseURL"><span class="hs-identifier hs-var">baseURL</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;api/1/products&quot;</span><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-comment">-- | Authenticate to the Tesla service.</span><span>
</span><a name="line-49"></a><span class="hs-identifier">authenticate</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Tesla.Auth.html#AuthInfo"><span class="hs-identifier hs-type">AuthInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Tesla.Auth.html#AuthResponse"><span class="hs-identifier hs-type">AuthResponse</span></a><span>
</span><a name="line-50"></a><a name="authenticate"><a href="Tesla.html#authenticate"><span class="hs-identifier">authenticate</span></a></a><span> </span><a href="Tesla.Auth.html#AuthInfo"><span class="hs-identifier hs-var">AuthInfo</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-51"></a><span>  </span><a href="Tesla.Internal.HTTP.html#jpostWith"><span class="hs-identifier hs-var">jpostWith</span></a><span> </span><a href="Tesla.Internal.HTTP.html#defOpts"><span class="hs-identifier hs-var">defOpts</span></a><span> </span><a href="Tesla.html#authURL"><span class="hs-identifier hs-var">authURL</span></a><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;grant_type&quot;</span><span> </span><span class="hs-operator hs-var">:=</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;password&quot;</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-52"></a><span>                             </span><span class="hs-string">&quot;client_id&quot;</span><span> </span><span class="hs-operator hs-var">:=</span><span> </span><a href="#local-6989586621679140541"><span class="hs-identifier hs-var">_clientID</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>                             </span><span class="hs-string">&quot;client_secret&quot;</span><span> </span><span class="hs-operator hs-var">:=</span><span> </span><a href="#local-6989586621679140542"><span class="hs-identifier hs-var">_clientSecret</span></a><span class="hs-special">,</span><span>
</span><a name="line-54"></a><span>                             </span><span class="hs-string">&quot;email&quot;</span><span> </span><span class="hs-operator hs-var">:=</span><span> </span><a href="#local-6989586621679140543"><span class="hs-identifier hs-var">_email</span></a><span class="hs-special">,</span><span>
</span><a name="line-55"></a><span>                             </span><span class="hs-string">&quot;password&quot;</span><span> </span><span class="hs-operator hs-var">:=</span><span> </span><a href="#local-6989586621679140544"><span class="hs-identifier hs-var">_password</span></a><span class="hs-special">]</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-comment">-- | Refresh authentication credentials using a refresh token.</span><span>
</span><a name="line-58"></a><span class="hs-identifier">refreshAuth</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Tesla.Auth.html#AuthInfo"><span class="hs-identifier hs-type">AuthInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tesla.Auth.html#AuthResponse"><span class="hs-identifier hs-type">AuthResponse</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Tesla.Auth.html#AuthResponse"><span class="hs-identifier hs-type">AuthResponse</span></a><span>
</span><a name="line-59"></a><a name="refreshAuth"><a href="Tesla.html#refreshAuth"><span class="hs-identifier">refreshAuth</span></a></a><span> </span><a href="Tesla.Auth.html#AuthInfo"><span class="hs-identifier hs-var">AuthInfo</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a href="Tesla.Auth.html#AuthResponse"><span class="hs-identifier hs-var">AuthResponse</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-60"></a><span>  </span><a href="Tesla.Internal.HTTP.html#jpostWith"><span class="hs-identifier hs-var">jpostWith</span></a><span> </span><a href="Tesla.Internal.HTTP.html#defOpts"><span class="hs-identifier hs-var">defOpts</span></a><span> </span><a href="Tesla.html#authRefreshURL"><span class="hs-identifier hs-var">authRefreshURL</span></a><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;grant_type&quot;</span><span> </span><span class="hs-operator hs-var">:=</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;refresh_token&quot;</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-61"></a><span>                                    </span><span class="hs-string">&quot;client_id&quot;</span><span> </span><span class="hs-operator hs-var">:=</span><span> </span><a href="#local-6989586621679140546"><span class="hs-identifier hs-var">_clientID</span></a><span class="hs-special">,</span><span>
</span><a name="line-62"></a><span>                                    </span><span class="hs-string">&quot;client_secret&quot;</span><span> </span><span class="hs-operator hs-var">:=</span><span> </span><a href="#local-6989586621679140547"><span class="hs-identifier hs-var">_clientSecret</span></a><span class="hs-special">,</span><span>
</span><a name="line-63"></a><span>                                    </span><span class="hs-string">&quot;refresh_token&quot;</span><span> </span><span class="hs-operator hs-var">:=</span><span> </span><a href="#local-6989586621679140553"><span class="hs-identifier hs-var">_refresh_token</span></a><span class="hs-special">]</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span class="hs-comment">-- | A VehicleID.</span><span>
</span><a name="line-67"></a><span class="hs-keyword">type</span><span> </span><a name="VehicleID"><a href="Tesla.html#VehicleID"><span class="hs-identifier">VehicleID</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-comment">-- | An energy site ID.</span><span>
</span><a name="line-70"></a><span class="hs-keyword">type</span><span> </span><a name="EnergyID"><a href="Tesla.html#EnergyID"><span class="hs-identifier">EnergyID</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-comment">-- | Tesla Product Types.</span><span>
</span><a name="line-73"></a><span class="hs-keyword">data</span><span> </span><a name="Product"><a href="Tesla.html#Product"><span class="hs-identifier">Product</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ProductVehicle"><a href="Tesla.html#ProductVehicle"><span class="hs-identifier">ProductVehicle</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="_vehicleName"><a href="Tesla.html#_vehicleName"><span class="hs-identifier">_vehicleName</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Text</span><span class="hs-special">,</span><span> </span><a name="_vehicleID"><a href="Tesla.html#_vehicleID"><span class="hs-identifier">_vehicleID</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Tesla.html#VehicleID"><span class="hs-identifier hs-type">VehicleID</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-74"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a name="ProductEnergy"><a href="Tesla.html#ProductEnergy"><span class="hs-identifier">ProductEnergy</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="_energyID"><a href="Tesla.html#_energyID"><span class="hs-identifier">_energyID</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Tesla.html#EnergyID"><span class="hs-identifier hs-type">EnergyID</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-75"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a name="ProductPowerWall"><a href="Tesla.html#ProductPowerWall"><span class="hs-identifier">ProductPowerWall</span></a></a><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Read</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span class="hs-identifier hs-var">makePrisms</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">Product</span><span>
</span><a name="line-78"></a><span class="hs-identifier hs-var">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">Product</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-identifier">decodeProducts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Value</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Tesla.html#Product"><span class="hs-identifier hs-type">Product</span></a><span class="hs-special">]</span><span>
</span><a name="line-81"></a><a name="decodeProducts"><a href="Tesla.html#decodeProducts"><span class="hs-identifier">decodeProducts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">toListOf</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">key</span><span> </span><span class="hs-string">&quot;response&quot;</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">_Array</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">folded</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">to</span><span> </span><a href="#local-6989586621679144520"><span class="hs-identifier hs-var">prod</span></a><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-83"></a><span>    </span><a name="local-6989586621679144520"><a href="#local-6989586621679144520"><span class="hs-identifier">prod</span></a></a><span> </span><a name="local-6989586621679144521"><a href="#local-6989586621679144521"><span class="hs-identifier">o</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">asum</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679144522"><span class="hs-identifier hs-var">prodCar</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679144523"><span class="hs-identifier hs-var">prodSolar</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-84"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-85"></a><span>        </span><a name="local-6989586621679144522"><a href="#local-6989586621679144522"><span class="hs-identifier">prodCar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Tesla.html#ProductVehicle"><span class="hs-identifier hs-var">ProductVehicle</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679144521"><span class="hs-identifier hs-var">o</span></a><span> </span><span class="hs-operator hs-var">^?</span><span> </span><span class="hs-identifier hs-var">key</span><span> </span><span class="hs-string">&quot;display_name&quot;</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">_String</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679144521"><span class="hs-identifier hs-var">o</span></a><span> </span><span class="hs-operator hs-var">^?</span><span> </span><span class="hs-identifier hs-var">key</span><span> </span><span class="hs-string">&quot;id_s&quot;</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">_String</span><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span>        </span><a name="local-6989586621679144523"><a href="#local-6989586621679144523"><span class="hs-identifier">prodSolar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Tesla.html#ProductEnergy"><span class="hs-identifier hs-var">ProductEnergy</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679144521"><span class="hs-identifier hs-var">o</span></a><span> </span><span class="hs-operator hs-var">^?</span><span> </span><span class="hs-identifier hs-var">key</span><span> </span><span class="hs-string">&quot;energy_site_id&quot;</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">_Integer</span><span class="hs-special">)</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-comment">-- | Get all products associated with this account.</span><span>
</span><a name="line-89"></a><span class="hs-identifier">products</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679144519"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Tesla.Auth.html#AuthInfo"><span class="hs-identifier hs-type">AuthInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679144519"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="Tesla.html#Product"><span class="hs-identifier hs-type">Product</span></a><span class="hs-special">]</span><span>
</span><a name="line-90"></a><a name="products"><a href="Tesla.html#products"><span class="hs-identifier">products</span></a></a><span> </span><a name="local-6989586621679144674"><a href="#local-6989586621679144674"><span class="hs-identifier">ai</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Tesla.html#decodeProducts"><span class="hs-identifier hs-var">decodeProducts</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Tesla.Internal.HTTP.html#jgetWith"><span class="hs-identifier hs-var">jgetWith</span></a><span> </span><span class="hs-special">(</span><a href="Tesla.Internal.HTTP.html#authOpts"><span class="hs-identifier hs-var">authOpts</span></a><span> </span><a href="#local-6989586621679144674"><span class="hs-identifier hs-var">ai</span></a><span class="hs-special">)</span><span> </span><a href="Tesla.html#productsURL"><span class="hs-identifier hs-var">productsURL</span></a><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-comment">-- | Get a mapping of vehicle name to vehicle ID.</span><span>
</span><a name="line-93"></a><span class="hs-identifier">vehicles</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679144518"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Tesla.Auth.html#AuthInfo"><span class="hs-identifier hs-type">AuthInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679144518"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-identifier hs-type">Text</span><span class="hs-special">)</span><span>
</span><a name="line-94"></a><a name="vehicles"><a href="Tesla.html#vehicles"><span class="hs-identifier">vehicles</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map.fromList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">toListOf</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">folded</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Tesla.html#_ProductVehicle"><span class="hs-identifier hs-var">_ProductVehicle</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Tesla.html#products"><span class="hs-identifier hs-var">products</span></a><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span class="hs-comment">-- | Get a list of Solar ID installations.</span><span>
</span><a name="line-97"></a><span class="hs-identifier">energyIDs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679144517"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Tesla.Auth.html#AuthInfo"><span class="hs-identifier hs-type">AuthInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679144517"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="Tesla.html#EnergyID"><span class="hs-identifier hs-type">EnergyID</span></a><span class="hs-special">]</span><span>
</span><a name="line-98"></a><a name="energyIDs"><a href="Tesla.html#energyIDs"><span class="hs-identifier">energyIDs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toListOf</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">folded</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Tesla.html#_ProductEnergy"><span class="hs-identifier hs-var">_ProductEnergy</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Tesla.html#products"><span class="hs-identifier hs-var">products</span></a><span>
</span><a name="line-99"></a></pre></body></html>